webpackJsonp([1],{104:function(t,e){},105:function(t,e){},106:function(t,e,a){function n(t){a(175)}var i=a(212)(a(109),a(213),n,null,null);t.exports=i.exports},108:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(107),i=a(105),s=(a.n(i),a(104)),o=(a.n(s),a(106)),r=a.n(o);n.a.config.productionTip=!1,new n.a({el:"#app",template:"<App/>",components:{App:r.a}})},109:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a(112),i=a.n(n),s=a(113),o=a.n(s),r=a(114),c=a.n(r),l=a(115),u=a.n(l),p=a(111),d=a.n(p),v=a(203),f=a.n(v),g=a(176),m=a.n(g),h=a(182),b=a.n(h);e.default={name:"app",data:function(){return{csv:{},search:"",groups:{},files:[],incomingFiles:[],csvDropActive:!1,showModal:!1,activeTab:"G",groupsImportData:"",selectedLanguage:"en",lang:{en:{identifierPrefixLength:11,identifier:"Identifier",group:"Group",grade:"Grade",gradeMax:"Maximum Grade",feedback:"Feedback comments"},fr:{identifierPrefixLength:11,identifier:"Identifiant",group:"Groupe",grade:"Note",gradeMax:"Note maximale",feedback:"Feedback par commentaires"}}}},mounted:function(){var t=this;if(window.location.search){var e=window.location.search.split("?url=")[1];this.downloadFile(e).then(function(e){t.incomingFiles=e})}},computed:{filteredStudents:function(){var t=this;return this.csv.data.filter(function(e){return t.csv.meta.fields.some(function(a){return e[a].toLowerCase().indexOf(t.search.toLowerCase())>-1})})},filteredGroups:function(){var t=this;return d()(this.groups).filter(function(e){return e.toLowerCase().indexOf(t.search.toLowerCase())>-1}).sort()},langLookup:function(){return this.lang[this.selectedLanguage]}},methods:{reset:function(){this.csv={},this.files=[],this.search=""},parse:function(){var t=this;if(this.$refs.fileInput.files.length<1)return this.csv={},void(this.groups={});f.a.parse(this.$refs.fileInput.files[0],{header:!0,skipEmptyLines:!0,complete:function(e){t.csv=e;var a=d()(t.lang).find(function(e){return t.lang[e].identifier===t.csv.meta.fields[0]});a&&(t.selectedLanguage=a),[].concat(u()(new c.a(t.csv.data.map(function(e){return e[t.langLookup.group]})))).forEach(function(e){var a={};a[t.langLookup.grade]="",a[t.langLookup.feedback]="",t.$set(t.groups,e,a)})}})},importGroupFeedback:function(){var t=this;f.a.parse(this.groupsImportData,{header:!1,skipEmptyLines:!0,complete:function(e){e.data.forEach(function(e){var a=e[0],n=e[1],i=e[2],s={};s[t.langLookup.grade]=n,s[t.langLookup.feedback]=i,t.$set(t.groups,a,s),t.updateGroupField({target:{value:n}},a,t.langLookup.grade),t.updateGroupField({target:{value:i}},a,t.langLookup.feedback)})}})},unparse:function(){var t=f.a.unparse(this.csv.data,{quotes:!0,newline:this.csv.meta.linebreak,delimiter:this.csv.meta.delimiter}),e=new Blob([t],{type:"text/csv;charset=utf-8"});m.a.saveAs(e,"out.csv")},findFile:function(t){return this.files.find(function(e){return e.name.indexOf(t)>-1})},filenameForGroup:function(t){var e=this.findFile(t);return e?e.name:""},zip:function(){var t=this;this.showModal=!0;var e=new b.a;this.csv.data.forEach(function(a){var n=t.findFile(a[t.langLookup.group]);if(n){var i=a[t.langLookup.identifier].slice(t.langLookup.identifierPrefixLength),s=a[t.langLookup.group],o=n.name.split(".").pop();e.file(s+"_"+i+"_assignsubmission_file_Feedback-"+s+"."+o,n)}}),e.generateAsync({type:"blob"}).then(function(e){m.a.saveAs(e,"upload.zip"),t.showModal=!1})},isEditableNumber:function(t){return[this.langLookup.grade].indexOf(t)>-1},isEditableTextarea:function(t){return[this.langLookup.feedback].indexOf(t)>-1},updateGroupField:function(t,e,a){var n=this;this.csv.data.forEach(function(i){i[n.langLookup.group]===e&&(i[a]=t.target.value)})},groupFillDownFrom:function(t){var e=this,a=this.groups[this.filteredGroups[t]];this.filteredGroups.slice(t+1).forEach(function(t){e.groups[t][e.langLookup.grade]=a[e.langLookup.grade],e.groups[t][e.langLookup.feedback]=a[e.langLookup.feedback],e.csv.data.forEach(function(n){n[e.langLookup.group]===t&&(n[e.langLookup.grade]=a[e.langLookup.grade],n[e.langLookup.feedback]=a[e.langLookup.feedback])})})},filterGroup:function(t){this.search===t?this.search="":this.search=t},unzip:function(t){var e=this;return b.a.loadAsync(t).then(function(t){return o.a.all(i()(t.files).map(function(t){return t.async("uint8array").then(function(e){return new File(e,t.name)})})).then(function(t){return e.addFiles(t)})},function(t){console.log(t)})},handleFeedbackFiles:function(){var t=this;this.showModal=!0,this.addFiles([].concat(u()(this.$refs.feedbackInput.files))).then(function(){t.showModal=!1,t.$refs.feedbackInput.value=null})},downloadFile:function(t){var e=this;return 0===t.indexOf("http")?fetch(t,{method:"GET"}).then(function(t){return t.blob()}).then(function(a){return a.lastModifiedDate=new Date,a.name=t.split("/").pop(),e.addFiles([a])}):o.a.resolve([])},addFiles:function(t){var e=this;return o.a.all(t.map(function(t){return t.name.indexOf(".zip")>=0?e.unzip(t):t.name.indexOf(".json")>=0?new o.a(function(a,n){var i=new FileReader;i.onload=function(t){t.error&&n(t.error);try{o.a.all(JSON.parse(t.target.result).map(function(t){return e.downloadFile(t)})).then(function(t){var e;return a((e=[]).concat.apply(e,u()(t)))})}catch(t){a()}},i.readAsText(t)}):(e.files.push(t),o.a.resolve(t.name))})).then(function(t){var e;return(e=[]).concat.apply(e,u()(t))})}}}},175:function(t,e){},213:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("header",[a("section",{staticClass:"container grid-960"},[a("nav",{staticClass:"navbar"},[t._m(0),t._v(" "),a("section",{staticClass:"navbar-section"},[a("div",{staticClass:"input-group input-inline"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"form-input",attrs:{type:"text",placeholder:"search"},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._v(" "),a("button",{staticClass:"btn btn-action ml-10",attrs:{title:"reset"},on:{click:t.reset}},[a("i",{staticClass:"icon icon-refresh"})])])])])])]),t._v(" "),a("div",{staticClass:"content container grid-960"},[t.csv.errors&&t.csv.errors.length>0?a("div",{staticClass:"toast toast-error"},t._l(t.csv.errors,function(e){return a("p",[a("strong",[t._v(t._s(e.type)+" (row: "+t._s(e.row)+"):")]),t._v(" "+t._s(e.message)+".\n      ")])})):t._e(),t._v(" "),t.incomingFiles.length>0&&!t.csv.meta?a("div",{staticClass:"toast"},[t._v("\n      Downloaded incoming files for you: "+t._s(t.incomingFiles.join(", "))+"\n    ")]):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.csv.meta,expression:"!csv.meta"}],staticClass:"empty file-drop-area",class:{"is-active":t.csvDropActive}},[t._m(1),t._v(" "),a("h4",{staticClass:"empty-title"},[t._v("No CSV file uploaded")]),t._v(" "),a("p",{staticClass:"empty-subtitle"},[t._v("Drag and drop a CSV file here, or click the button.")]),t._v(" "),a("div",{staticClass:"empty-action"},[a("button",{staticClass:"btn btn-primary"},[t._v("Choose file")]),t._v(" "),a("input",{ref:"fileInput",staticClass:"file-input",attrs:{type:"file",accept:".csv, text/csv"},on:{change:t.parse,dragleave:function(e){t.csvDropActive=!1},blur:function(e){t.csvDropActive=!1},drop:function(e){t.csvDropActive=!1},dragenter:function(e){t.csvDropActive=!0},focus:function(e){t.csvDropActive=!0},click:function(e){t.csvDropActive=!0}}})])]),t._v(" "),t.csv.meta?a("div",[a("ul",{staticClass:"tab tab-block"},[a("li",{staticClass:"tab-item"},[a("a",{staticClass:"badge",class:{active:"G"===t.activeTab},attrs:{href:"#","data-badge":t.filteredGroups.length},on:{click:function(e){e.preventDefault(),t.activeTab="G"}}},[t._v("Groups")])]),t._v(" "),a("li",{staticClass:"tab-item"},[a("a",{staticClass:"badge",class:{active:"F"===t.activeTab},attrs:{href:"#","data-badge":t.files.length},on:{click:function(e){e.preventDefault(),t.activeTab="F"}}},[t._v("Feedback Files")])]),t._v(" "),a("li",{staticClass:"tab-item"},[a("a",{staticClass:"badge",class:{active:"S"===t.activeTab},attrs:{href:"#","data-badge":t.filteredStudents.length},on:{click:function(e){e.preventDefault(),t.activeTab="S"}}},[t._v("Participants")])]),t._v(" "),a("li",{staticClass:"tab-item tab-action ml-10"},[a("div",{staticClass:"input-group input-inline"},[a("button",{staticClass:"btn btn-primary input-group-btn ml-10 mr-10",on:{click:t.unparse}},[t._v("Download CSV")]),t._v(" "),a("button",{staticClass:"btn btn-primary input-group-btn ",on:{click:t.zip}},[t._v("Download ZIP")])])])]),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:"G"===t.activeTab,expression:"activeTab === 'G'"}]},[a("table",{staticClass:"table table-striped table-hover"},[a("thead",[a("tr",[a("th",[t._v(t._s(t.langLookup.group))]),t._v(" "),a("th",[t._v(t._s(t.langLookup.grade))]),t._v(" "),a("th",[t._v(t._s(t.langLookup.feedback))]),t._v(" "),a("th",[t._v("Action")]),t._v(" "),a("th",[t._v("File")])])]),t._v(" "),a("transition-group",{attrs:{name:"list",tag:"tbody"}},t._l(t.filteredGroups,function(e,n){return a("tr",{key:e},[a("td",[a("a",{attrs:{href:"#"},on:{click:function(a){a.preventDefault(),t.filterGroup(e)}}},[t._v(t._s(e))])]),t._v(" "),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.groups[e][t.langLookup.grade],expression:"groups[group][langLookup.grade]"}],staticClass:"grade",attrs:{type:"number"},domProps:{value:t.groups[e][t.langLookup.grade]},on:{change:function(a){t.updateGroupField(a,e,t.langLookup.grade)},keyup:function(a){t.updateGroupField(a,e,t.langLookup.grade)},input:function(a){a.target.composing||t.$set(t.groups[e],t.langLookup.grade,a.target.value)}}})]),t._v(" "),a("td",[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.groups[e][t.langLookup.feedback],expression:"groups[group][langLookup.feedback]"}],staticClass:"feedback",domProps:{value:t.groups[e][t.langLookup.feedback]},on:{keyup:function(a){t.updateGroupField(a,e,t.langLookup.feedback)},input:function(a){a.target.composing||t.$set(t.groups[e],t.langLookup.feedback,a.target.value)}}})]),t._v(" "),a("td",[a("button",{staticClass:"btn",on:{click:function(e){t.groupFillDownFrom(n)}}},[a("i",{staticClass:"icon icon-downward"}),t._v(" Fill down")])]),t._v(" "),a("td",[t._v("\n                "+t._s(t.filenameForGroup(e))+"\n              ")])])}))],1),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"form-label",attrs:{for:"import"}},[t._v("Import values group, grade, comment (no header, copy past from Excel\n            or CSV)")]),t._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.groupsImportData,expression:"groupsImportData"}],staticClass:"form-input",attrs:{id:"import",placeholder:"A01, 1, ",rows:"3"},domProps:{value:t.groupsImportData},on:{input:function(e){e.target.composing||(t.groupsImportData=e.target.value)}}})]),t._v(" "),a("button",{staticClass:"btn btn-primary",on:{click:t.importGroupFeedback}},[t._v("Import")])]),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:"F"===t.activeTab,expression:"activeTab === 'F'"}]},[a("div",{staticClass:"empty file-drop-area",class:{"is-active":t.csvDropActive}},[t._m(2),t._v(" "),a("h4",{staticClass:"empty-title"},[t._v("Drag and drop feedback files or a zip with files")]),t._v(" "),a("p",{staticClass:"empty-subtitle"},[t._v("The feedback file should include the name of a group to be matched.")]),t._v(" "),a("div",{staticClass:"empty-action"},[a("button",{staticClass:"btn btn-primary"},[t._v("Choose file")]),t._v(" "),a("input",{ref:"feedbackInput",staticClass:"file-input",attrs:{type:"file",multiple:""},on:{change:t.handleFeedbackFiles,dragleave:function(e){t.csvDropActive=!1},blur:function(e){t.csvDropActive=!1},drop:function(e){t.csvDropActive=!1},dragenter:function(e){t.csvDropActive=!0},focus:function(e){t.csvDropActive=!0},click:function(e){t.csvDropActive=!0}}})])]),t._v(" "),a("ul",t._l(t.files,function(e){return a("li",[t._v(t._s(e.name))])}))]),t._v(" "),a("section",{directives:[{name:"show",rawName:"v-show",value:"S"===t.activeTab,expression:"activeTab === 'S'"}],staticStyle:{overflow:"auto"}},[t.csv.meta?a("table",{staticClass:"table table-striped table-hover"},[a("thead",[a("tr",t._l(t.csv.meta.fields,function(e){return a("th",[t._v(t._s(e))])}))]),t._v(" "),a("transition-group",{attrs:{name:"list",tag:"tbody"}},t._l(t.filteredStudents,function(e){return a("tr",{key:e[t.langLookup.identifier]},t._l(t.csv.meta.fields,function(n){return a("td",[t.isEditableNumber(n)?a("input",{directives:[{name:"model",rawName:"v-model",value:e[n],expression:"student[field]"}],attrs:{type:"number",min:"0",max:e[t.langLookup.gradeMax]},domProps:{value:e[n]},on:{input:function(a){a.target.composing||t.$set(e,n,a.target.value)}}}):t.isEditableTextarea(n)?a("textarea",{directives:[{name:"model",rawName:"v-model",value:e[n],expression:"student[field]"}],domProps:{value:e[n]},on:{input:function(a){a.target.composing||t.$set(e,n,a.target.value)}}}):n===t.langLookup.group?a("a",{attrs:{href:"#"},on:{click:function(a){a.preventDefault(),t.filterGroup(e[n])}}},[t._v(t._s(e[n]))]):a("span",[t._v(t._s(e[n]))])])}))}))],1):t._e()])]):t._e()]),t._v(" "),a("div",{staticClass:"modal",class:{active:t.showModal}},[a("div",{staticClass:"modal-overlay"}),t._v(" "),t._m(3)])])},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"navbar-section"},[a("a",{staticClass:"navbar-brand mr-10",attrs:{href:"#"}},[t._v("Moodle Assignment Feedback Packager")]),t._v(" "),a("a",{staticClass:"btn btn-link",attrs:{href:"https://github.com/bfritscher/moodle-assignment-feedback-packager"}},[t._v("GitHub")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"empty-icon"},[a("i",{staticClass:"icon icon-upload"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"empty-icon"},[a("i",{staticClass:"icon icon-upload"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-container"},[a("div",{staticClass:"modal-header"},[a("div",{staticClass:"modal-title"},[t._v("Processing file(s)")])]),t._v(" "),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"loading"})]),t._v(" "),a("div",{staticClass:"modal-footer"})])}]}},217:function(t,e){}},[108]);
//# sourceMappingURL=app.de299fb59d2ef7f250b5.js.map